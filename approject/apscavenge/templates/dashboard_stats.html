<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
</style>

<div class="center">
    {% for area in areas_stats %}
    <div style="display: inline-block;">
        <canvas id="{{ area }}" class="doughnut"></canvas>
    </div>
    {% endfor %}

    {% if areas_stats|length == 0 %}
    <svg class="mb-4" fill="#ef9a38" width="70" aria-hidden="true" focusable="false" data-prefix="fal" data-icon="info-circle" class="svg-inline--fa fa-info-circle fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 40c118.621 0 216 96.075 216 216 0 119.291-96.61 216-216 216-119.244 0-216-96.562-216-216 0-119.203 96.602-216 216-216m0-32C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm-36 344h12V232h-12c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h48c6.627 0 12 5.373 12 12v140h12c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12h-72c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12zm36-240c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32z"></path></svg>
    <h5>No current stats</h5>
    {% endif %}
</div>

<script>
    // Setup
    let data = {
        labels: [
            'Secure',
            'Vulnerable'
        ],
        datasets: [{
            label: null,
            data: null,
            backgroundColor: [
                'rgb(80, 202, 80)',
                'rgb(226, 96, 96)'
            ],
            hoverOffset: 4
        }]
    };

    // Config
    let config = {
        type: 'doughnut',
        data: null,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%', // Adjust the cutout percentage to control the size of the doughnut
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: null
                }
            }
        },
    };

    const areasStatsData = {{ areas_stats|safe }};
    const chartElements = document.querySelectorAll('.doughnut');
    chartElements.forEach((element, index) => {
        let currentArea = element.getAttribute('id');

        data.datasets[0].label = `Users`;
        data.datasets[0].data = areasStatsData[currentArea];

        config.data = data;
        config.options.plugins.title.text = `"${currentArea}" Area Vulnerability Ratio`;

        new Chart(element.getContext('2d'), config);
    });
</script>